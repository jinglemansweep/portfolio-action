<!doctype html>
<html lang="${lang}" dir="${dir}">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <base href="${base_path}" />
    <title>${title}</title>
    <meta name="description" content="${description}" />
    <meta name="robots" content="${robots_meta}" />
    ${rss_link}

    <!-- Tailwind via CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>

    <!-- Lit via CDN -->
    <script type="module">
      import 'https://cdn.jsdelivr.net/npm/lit@3/+esm';
    </script>

    <!-- App components -->
    <script type="module" src="./components/app-shell.js"></script>

    <!-- Dark mode: class-based strategy for Tailwind v4 browser build -->
    <style type="text/tailwindcss">
      @custom-variant dark (&:where(.dark, .dark *));
    </style>

    <!-- Theme custom properties -->
    <style>
      :root {
        --color-primary: ${primary};
        --color-accent: ${accent};
      }
    </style>

    <!-- Prose typography (browser build has no @plugin support) -->
    <style>
      .prose {
        color: #374151;
        line-height: 1.75;
      }
      .prose :where(h1, h2, h3, h4, h5, h6) {
        color: #111827;
        font-weight: 700;
        line-height: 1.3;
        margin-top: 1.5em;
        margin-bottom: 0.5em;
      }
      .prose :where(h1) {
        font-size: 2.25em;
      }
      .prose :where(h2) {
        font-size: 1.5em;
      }
      .prose :where(h3) {
        font-size: 1.25em;
      }
      .prose :where(p) {
        margin-top: 0.75em;
        margin-bottom: 0.75em;
      }
      .prose :where(a) {
        color: #2563eb;
        text-decoration: underline;
      }
      .prose :where(a:hover) {
        color: #1d4ed8;
      }
      .prose :where(strong) {
        font-weight: 700;
      }
      .prose :where(ul, ol) {
        padding-left: 1.5em;
        margin-top: 0.75em;
        margin-bottom: 0.75em;
      }
      .prose :where(ul) {
        list-style-type: disc;
      }
      .prose :where(ol) {
        list-style-type: decimal;
      }
      .prose :where(li) {
        margin-top: 0.25em;
        margin-bottom: 0.25em;
      }
      .prose :where(blockquote) {
        border-left: 4px solid #d1d5db;
        padding-left: 1em;
        font-style: italic;
        color: #6b7280;
        margin-top: 1em;
        margin-bottom: 1em;
      }
      .prose :where(code) {
        background: #f3f4f6;
        padding: 0.15em 0.3em;
        border-radius: 0.25em;
        font-size: 0.875em;
      }
      .prose :where(pre) {
        background: #1f2937;
        color: #e5e7eb;
        padding: 1em;
        border-radius: 0.5em;
        overflow-x: auto;
        margin-top: 1em;
        margin-bottom: 1em;
      }
      .prose :where(pre code) {
        background: none;
        padding: 0;
        font-size: 0.875em;
      }
      .prose :where(img) {
        max-width: 100%;
        height: auto;
        margin-top: 1em;
        margin-bottom: 1em;
      }
      .prose :where(hr) {
        border-color: #e5e7eb;
        margin-top: 2em;
        margin-bottom: 2em;
      }
      .prose :where(table) {
        width: 100%;
        border-collapse: collapse;
        margin-top: 1em;
        margin-bottom: 1em;
      }
      .prose :where(th, td) {
        border: 1px solid #d1d5db;
        padding: 0.5em 0.75em;
        text-align: left;
      }
      .prose :where(th) {
        background: #f9fafb;
        font-weight: 600;
      }
      .prose-sm {
        font-size: 0.875em;
      }
      .prose-lg {
        font-size: 1.125em;
      }

      /* Dark mode prose invert */
      .dark .prose-invert,
      .dark .prose-invert :where(h1, h2, h3, h4, h5, h6) {
        color: #e5e7eb;
      }
      .dark .prose-invert :where(a) {
        color: #60a5fa;
      }
      .dark .prose-invert :where(a:hover) {
        color: #93bbfd;
      }
      .dark .prose-invert :where(blockquote) {
        border-color: #4b5563;
        color: #9ca3af;
      }
      .dark .prose-invert :where(code) {
        background: #374151;
        color: #e5e7eb;
      }
      .dark .prose-invert :where(pre) {
        background: #111827;
      }
      .dark .prose-invert :where(hr) {
        border-color: #374151;
      }
      .dark .prose-invert :where(th, td) {
        border-color: #4b5563;
      }
      .dark .prose-invert :where(th) {
        background: #1f2937;
      }
    </style>

    <!-- Preconnect hints -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin />
    <link rel="preconnect" href="https://cdn.simpleicons.org" crossorigin />

    <!-- Theme init â€” prevent FOUC -->
    <script>
      (function () {
        const stored = localStorage.getItem('theme');
        const prefersDark = matchMedia('(prefers-color-scheme: dark)').matches;
        const mode = '${theme_mode}';
        const dark =
          stored === 'dark' ||
          (stored !== 'light' &&
            (mode === 'dark' || (mode === 'system' && prefersDark)));
        if (dark) document.documentElement.classList.add('dark');
      })();
    </script>
  </head>
  <body class="bg-white dark:bg-gray-900">
    <a href="#main-content" class="sr-only focus:not-sr-only"
      >${a11y_skip_to_content}</a
    >
    <app-shell></app-shell>
  </body>
</html>
